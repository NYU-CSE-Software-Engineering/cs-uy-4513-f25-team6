<h1><%= params[:status] || 'All' %> Appointments</h1>

<div class="filter-section">
  <%= form_with url: request.path, method: :get, local: true do |form| %>
    <%= form.label :status, "Status" %>
    <%= form.select :status, options_for_select(['All', 'Upcoming', 'Completed'], params[:status]) %>
    <%= form.submit "Filter" %>
  <% end %>
</div>
<hr>
<%# ------------------------- %>

<% if @appointments.any? %>
  <ul>
    <% @appointments.each do |appointment| %>
      <li class="appointment-row">
        <strong>Date:</strong>
        <%= appointment.date %><br>

        <strong>Time:</strong>
        <%= appointment.time_slot.starts_at.strftime("%I:%M %p") %> â€“
        <%= appointment.time_slot.ends_at.strftime("%I:%M %p") %>
        <br>

        <% if session[:role] == 'doctor' %>
          <strong>Patient:</strong>
          <%= appointment.patient&.username || "Patient" %>
          <% if appointment.full_datetime < DateTime.now %>
            <br>
            <% if appointment.bill %>
              <strong>Bill:</strong> <%= appointment.bill.status %>
            <% else %>
              <%= link_to "Create bill", new_bill_path %>
            <% end %>
          <% end %>
        <% else %>
          <strong>Doctor:</strong>
          <%= appointment.doctor&.username || "Doctor" %>
          <br>
          <strong>Clinic:</strong>
          <%= appointment.doctor.clinic.name %>
        <% end %>
      </li>
      <hr>
    <% end %>
  </ul>
<% else %>
  <p>You have no appointments.</p>
<% end %>