<h1><%= params[:status] || 'All' %> Appointments</h1>

<div class="filter-section">
  <%= form_with url: request.path, method: :get, local: true do |form| %>
    <%= form.label :status, "Status" %>
    <%= form.select :status, options_for_select(['All', 'Upcoming', 'Completed'], params[:status]) %>
    <%= form.submit "Filter" %>
  <% end %>
</div>
<hr>
<%# ------------------------- %>

<% if @appointments.any? %>
  <ul>
    <% @appointments.each do |appointment| %>
      <li class="appointment-row">
        <strong>Date:</strong>
        <%= appointment.date %><br>

        <strong>Time:</strong>
        <%= appointment.time_slot.starts_at.strftime("%I:%M %p") %> â€“
        <%= appointment.time_slot.ends_at.strftime("%I:%M %p") %><br>

        <% if session[:role] == 'doctor' %>
           <strong>Patient:</strong>
           <%= appointment.patient&.username || "Patient" %>
        <% else %>
           <strong>Doctor:</strong>
           <%= appointment.doctor&.username || "Doctor" %>
        <% end %>
        
        <%# Ensure clinic name is displayed if present %>
        <% if appointment.respond_to?(:clinic_name) && appointment.clinic_name.present? %>
          <br><strong>Clinic:</strong> <%= appointment.clinic_name %>
        <% else %>
          <br><strong>Clinic:</strong> N/A
        <% end %>
      </li>
      <hr>
    <% end %>
  </ul>
<% else %>
  <p>You have no appointments.</p>
<% end %>