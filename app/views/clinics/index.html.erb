<h1>Find Clinics</h1>

<%= form_tag(search_clinics_path, method: :get) do %>
  <%= label_tag :specialty %>
  <%= select_tag :specialty,
      options_for_select(
        Clinic.distinct.order(:specialty).pluck(:specialty),
        params[:specialty]
      ),
      include_blank: 'Any Specialty' %>

  <%= label_tag :location %>
  <%= select_tag :location,
      options_for_select(
        Clinic.distinct.order(:location).pluck(:location),
        params[:location]
      ),
      include_blank: 'Any Location' %>

  <%= submit_tag "Search" %>
<% end %>

<% if @clinics.present? %>
  <h2>All Clinics</h2>

  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Specialty</th>
        <th>Location</th>
        <th>Rating</th>
        <th>Actions</th>
      </tr>
    </thead>

    <tbody>
      <% @clinics.each do |clinic| %>
        <tr>
          <!-- patient flow: click clinic â†’ doctor search -->
          <td><%= link_to clinic.name, clinic_doctors_path(clinic) %></td>
          <td><%= clinic.specialty %></td>
          <td><%= clinic.location %></td>
          <td><%= clinic.rating %></td>
          <td>
            <!-- patient/general: explicit doctor list link -->
            <%= link_to "View doctors", clinic_doctors_path(clinic) %>

            <!-- doctor-only: sign up to work here -->
            <% if session[:role] == "doctor" %>
              <%= button_to "Sign up to work here",
                    clinic_employment_path(clinic_id: clinic.id),
                    method: :post %>
            <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
<% end %>
