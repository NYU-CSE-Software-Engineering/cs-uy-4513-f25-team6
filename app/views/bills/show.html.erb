<h1>Bill Details</h1>

<p>
  <strong>Appointment date:</strong>
  <%= @bill.appointment.date %>
</p>

<p>
  <strong>Doctor:</strong>
  <%= @bill.appointment.doctor&.username || "N/A" %>
</p>

<p>
  <strong>Amount:</strong>
  $<%= @bill.amount %>
</p>

<p>
  <strong>Status:</strong>
  <%= @bill.status %>
</p>

<% if @bill.due_date.present? %>
  <p>
    <strong>Due date:</strong>
    <%= @bill.due_date %>
  </p>
<% end %>

<% if flash[:notice].present? %>
  <p><%= flash[:notice] %></p>
<% end %>

<% if flash[:alert].present? %>
  <p><%= flash[:alert] %></p>
<% end %>

<% if session[:role] == 'patient' %>
  <h2>Payment Information</h2>
  <% if @bill.unpaid? %>
    <%= form_with url: bill_path(@bill), method: :patch do |f| %>
      <table class="table" style="width:430px">
        <tr>
          <td><%= f.label :card_number, "Card Number" %></td>
          <td><%= f.number_field :card_number %></td>
        </tr>
        <tr>
          <td><%= f.label :expiration_month, "Expiration Month" %></td>
          <td><%= f.number_field :expiration_month %></td>
        </tr>
        <tr>
          <td><%= f.label :expiration_year, "Expiration Year" %></td>
          <td><%= f.number_field :expiration_year %></td>
        </tr>
        <tr>
          <td><%= f.label :cvc, "CVC" %></td>
          <td><%= f.number_field :cvc %></td>
        </tr>
      </table>
      <%= f.submit "Pay Now" %>
    <% end %>
  <% else %>
    <p>This bill is already paid.</p>
  <% end %>
<% end %>
